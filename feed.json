{
    "version": "https://jsonfeed.org/version/1",
    "title": "EricLzu's Blog",
    "description": "Eric的博客",
    "home_page_url": "http://ericlzu.github.io",
    "items": [
        {
            "id": "http://ericlzu.github.io/2020/12/18/SoftRoCE/",
            "url": "http://ericlzu.github.io/2020/12/18/SoftRoCE/",
            "title": "",
            "date_published": "2020-12-18T06:45:12.878Z",
            "content_html": "<h1 id=\"简介\"><a class=\"markdownIt-Anchor\" href=\"#简介\">#</a> 简介</h1>\n<p>SoftRoCE 是 RDMA 的一种纯软件实现的方式，因此不需要特定的硬件支持，但是其性能与硬件支持的 RDMA 还是有一些差距的。通过 softRoCE 我们可以在传统的以太网进行 RoCE 通信。自 4.9.0 之后的内核已经内置 sofrRoCE 驱动，我们直接使用即可。</p>\n<h1 id=\"环境搭建\"><a class=\"markdownIt-Anchor\" href=\"#环境搭建\">#</a> 环境搭建</h1>\n<ol>\n<li>实验环境</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>Server</th>\n<th>Client</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ubuntu 18.04</td>\n<td>ubuntu 18.04</td>\n</tr>\n<tr>\n<td>kernel 5.4.0</td>\n<td>kernel 5.4.0</td>\n</tr>\n<tr>\n<td>x86</td>\n<td>x86</td>\n</tr>\n</tbody>\n</table>\n<ol start=\"2\">\n<li>安装相关软件</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install libibverbs-dev librdmacm-dev rdma-core</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">备注</span></span><br><span class=\"line\"> - libibverbs-dev - Development files for the libibverbs library</span><br><span class=\"line\"> - librdmacm-dev - Development files for the librdmacm library</span><br><span class=\"line\"> - rdma-core - RDMA core userspace infrastructure and documentation</span><br></pre></td></tr></table></figure>\n<h1 id=\"联通测试\"><a class=\"markdownIt-Anchor\" href=\"#联通测试\">#</a> 联通测试</h1>\n<p>1. 在 server 端和 client 端创建 RoCE interface：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rxe_cfg start</span><br><span class=\"line\">sudo rxe_cfg add enp3s0</span><br></pre></td></tr></table></figure>\n<pre><code>\t成功后出现：\n</code></pre>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20201214105731686.png\" alt=\"在这里插入图片描述\"> 2. 测试前准备<br>\n查看 rdma 设备：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ibv_devices</span><br><span class=\"line\">ibv_devinfo</span><br></pre></td></tr></table></figure>\n<p>3. 开始测试<br>\n采用 rping 命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#server:</span></span><br><span class=\"line\">\trping -s -a [server-ip] -v -C 10</span><br><span class=\"line\"><span class=\"comment\">#client:</span></span><br><span class=\"line\">\trping -c -a [server-ip] -v -C 10</span><br></pre></td></tr></table></figure>\n<p>测试结果（server）：<br>\n<img data-src=\"https://img-blog.csdnimg.cn/20201214154817983.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hzeF82MzYx,size_16,color_FFFFFF,t_70\" alt=\"在这里插入图片描述\"></p>\n<p>采用 ibv_rc_pingpong 命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#server：</span></span><br><span class=\"line\">\tibv_rc_pingpong -g 2 -d rxe0</span><br><span class=\"line\"><span class=\"comment\">#client:</span></span><br><span class=\"line\">\tibv_rc_pingpong -g 2 -d rxe1 [server-ip]</span><br></pre></td></tr></table></figure>\n<p>测试结果（server）：<br>\n<img data-src=\"https://img-blog.csdnimg.cn/20201214154609768.png\" alt=\"在这里插入图片描述\"><br>\n<strong>备注</strong>：<br>\n-g 是设置网口的 GID 值，其要正确设置，否则会出现不能通信的问题。这里的设置正确是指客户端和服务端的 GID 的类型要统一，比如：<br>\n两者要么都是：GID fe80::6977:7a66:fa55:5334 这种格式，要么都是：GID ::ffff:192.168.50.59 这种格式，在不同的电脑上设置 - g 1 或者 -g 2 出现的格式可能会不一样，所以我们需要通过灵活设置 GID 的值使二者的格式相同。<br>\n-d 是设置具体的 RDMA 设备，该值可由 sudo rxe_cfg status 得出：<br>\n<img data-src=\"https://img-blog.csdnimg.cn/20201214153503673.png\" alt=\"RDMA设备\"></p>\n<p>由上图可见，RDMA 设备值为 rxe0</p>\n<p><strong>对 GID 的解释：</strong><br>\n每当以太网设备的一个网络端口配置了一个 IP 地址时，就会在 GID 表格中创建一个表项。每个表项包含：GID 值，GID 类型，网络设备。对于两种模式都支持的设备端口，表中会存在两个 GID，有相同的值，但是类型不同。表项中的网络设备是该 GID 关联的以太网设备的 IP 地址。</p>\n<p>GID 格式有可以有两种：IPv4 和 IPv6。IPv4 版本的 GID 是一个 IPv4 映射的 IPv6 地址，而 IPv6 版本的 GID 是 IPv6 地址本身。对于 RoCEv2，关联到 IPv4 版本 GID 的三层网络包，其头三层头部是 IPv4，IPv6 亦然。对于 RoCEv1，关联到 IPv6 或 IPv4 版本 GID 的网络包，头部是 IPv6 或者 GRH。</p>\n<p>GID 表格项的总数等于 N (K+1)， N 是赋予给所有网络设备上关联端口的 IP 地址数量，包括 VLAN 设备，别名设备，和 bonding master。链路本地的 IPv6 地址被排除在这个计数之外，因为它们的 GID 总是存在的，是默认的 GID，处于每个 GID 表格的开始。K 是支持的 RoCE 类型数量。每个硬件端口的表格项数量限制在 128。show_gids 命令可以查看系统中的 GID 表。</p>\n<p>在系统文件 sysfs 中查看 GID 的路径是：</p>\n<p>GID 值：/sys/class/infinband/<device>/ports/<port>/gids/<index><br>\nGID 类型：/sys/class/infinband/<device>/ports/<port>/gid_attrs/types/<index><br>\nGID 网络设备：/sys/class/infinband/<device>/ports/<port>/gid_attrs/ndevs/<index><br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYnVybmluZ1RoZVN0YXIvYXJjaGl2ZS8yMDA0LzAxLzEzLzg1NjU2MTIuaHRtbA==\">参考来源</span></p>\n<h1 id=\"softroce带宽测试\"><a class=\"markdownIt-Anchor\" href=\"#softroce带宽测试\">#</a> SoftRoCE 带宽测试</h1>\n<ol>\n<li>安装测试软件</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install perftest</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>开始测试</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server：</span><br><span class=\"line\">\tib_send_bw -n 10000 -d rxe0 -i 1 -F --report_gbits</span><br><span class=\"line\">client:</span><br><span class=\"line\">\tib_send_bw -n 10000 -d rxe0 -i 1 -F --report_gbits [server-ip]</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>测试结果（server 端）:<br>\n<img data-src=\"https://img-blog.csdnimg.cn/20201214111146673.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hzeF82MzYx,size_16,color_FFFFFF,t_70\" alt=\"在这里插入图片描述\"></li>\n</ol>\n<h1 id=\"传统以太网带宽测试\"><a class=\"markdownIt-Anchor\" href=\"#传统以太网带宽测试\">#</a> 传统以太网带宽测试</h1>\n<h2 id=\"1-iperf\"><a class=\"markdownIt-Anchor\" href=\"#1-iperf\">#</a> 1. iperf</h2>\n<p>参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW4ubGludXhkZS5uZXQvaXBlcmY=\">iperf 使用指南</span></p>\n<ol>\n<li>安装测试软件</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install iperf</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>开始测试</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server：</span><br><span class=\"line\">\tiperf -s -i 1 -f m</span><br><span class=\"line\">client:</span><br><span class=\"line\">\tiperf -c [server-ip] -i 1 -t 30 -f m </span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>测试结果（server）<br>\n<img data-src=\"https://img-blog.csdnimg.cn/2020121411165986.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hzeF82MzYx,size_16,color_FFFFFF,t_70\" alt=\"在这里插入图片描述\"></li>\n</ol>\n<h2 id=\"2-qperf\"><a class=\"markdownIt-Anchor\" href=\"#2-qperf\">#</a> 2. qperf</h2>\n<ol>\n<li>安装</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install qperf</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>使用</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#server</span></span><br><span class=\"line\">qperf</span><br><span class=\"line\"><span class=\"comment\">#client</span></span><br><span class=\"line\">\t<span class=\"comment\">#直接测试TCP的带宽和延迟</span></span><br><span class=\"line\">\tqperf [server-ip] tcp_bw tcp_lat conf</span><br><span class=\"line\">\t<span class=\"comment\">#改变消息大小，从1Byte到64K，每次倍增的方式，通过测试查看带宽和延迟的变化情况</span></span><br><span class=\"line\">\tqperf myserver -oo msg_size:1:64K:*2 -vu tcp_lat tcp_bw</span><br></pre></td></tr></table></figure>\n<h1 id=\"rdma卡检测方法\"><a class=\"markdownIt-Anchor\" href=\"#rdma卡检测方法\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20va2Fpc2hpcmVuc2hpL3AvMTAyODYzMDcuaHRtbA==\">RDMA 卡检测方法</span></h1>\n",
            "tags": []
        },
        {
            "id": "http://ericlzu.github.io/2020/12/18/hello-world/",
            "url": "http://ericlzu.github.io/2020/12/18/hello-world/",
            "title": "Hello World",
            "date_published": "2020-12-18T01:30:42.475Z",
            "content_html": "<p>Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo</span>! This is your very first post. Check <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv\">documentation</span> for more info. If you get any problems when using Hexo, you can find the answer in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=\">troubleshooting</span> or you can ask me on <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL2lzc3Vlcw==\">GitHub</span>.</p>\n<h2 id=\"quick-start\"><a class=\"markdownIt-Anchor\" href=\"#quick-start\">#</a> Quick Start</h2>\n<h3 id=\"create-a-new-post\"><a class=\"markdownIt-Anchor\" href=\"#create-a-new-post\">#</a> Create a new post</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n<p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s\">Writing</span></p>\n<h3 id=\"run-server\"><a class=\"markdownIt-Anchor\" href=\"#run-server\">#</a> Run server</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=\">Server</span></p>\n<h3 id=\"generate-static-files\"><a class=\"markdownIt-Anchor\" href=\"#generate-static-files\">#</a> Generate static files</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s\">Generating</span></p>\n<h3 id=\"deploy-to-remote-sites\"><a class=\"markdownIt-Anchor\" href=\"#deploy-to-remote-sites\">#</a> Deploy to remote sites</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s\">Deployment</span></p>\n",
            "tags": []
        }
    ]
}